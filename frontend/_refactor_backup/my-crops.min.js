// my-crops.min.js
(function(){document.addEventListener('DOMContentLoaded',()=>{const addBtn=document.getElementById('add-crop-btn'),formModal=document.getElementById('crop-form-modal'),cancelBtn=document.getElementById('cancel-crop-form'),form=document.getElementById('crop-form'),cards=document.getElementById('crop-cards-container'),modalTitle=document.getElementById('crop-modal-title'),detailsModal=document.getElementById('crop-details-modal'),closeDetails=document.getElementById('close-details-modal'),editBtn=document.getElementById('edit-crop-btn'),detailsName=document.getElementById('details-crop-name'),detailsInfo=document.getElementById('details-crop-info'),photoUpload=document.getElementById('crop-photo-upload'),analysisPrompt=document.getElementById('analysis-prompt'),analysisResult=document.getElementById('analysis-result'),stateSel=document.getElementById('crop-state'),citySel=document.getElementById('crop-city');if(!addBtn||!form||!cards)return;const stateCity={Maharashtra:['Mumbai','Pune','Nagpur'],Karnataka:['Bangalore','Mysore','Hubli'],'Tamil Nadu':['Chennai','Coimbatore','Madurai'],'Uttar Pradesh':['Lucknow','Kanpur','Agra'],Punjab:['Amritsar','Ludhiana','Chandigarh']};let crops=[{id:1,name:'Wheat',state:'Punjab',city:'Amritsar',date:'2024-01-10',status:'Good'},{id:2,name:'Rice',state:'Karnataka',city:'Mysore',date:'2024-06-15',status:'Excellent'}],nextId=3,editingId=null;function populateStates(){Object.keys(stateCity).forEach(st=>stateSel.add(new Option(st,st)))}function render(){cards.innerHTML='';crops.forEach(c=>{const card=document.createElement('div');card.className='bg-gray-800/50 p-6 rounded-2xl border border-white/10 cursor-pointer hover:border-green-500/40 hover:shadow-[0_0_0_1px_rgba(16,185,129,0.2)] transition';card.dataset.id=c.id;const statusColors={Excellent:'bg-green-500/20 text-green-400 border border-green-500/30',Good:'bg-green-400/15 text-green-300 border border-green-400/30',Fair:'bg-yellow-400/15 text-yellow-300 border border-yellow-400/30',Poor:'bg-orange-500/15 text-orange-400 border border-orange-500/30',Critical:'bg-red-600/15 text-red-500 border border-red-600/30','Pending Analysis':'bg-white/10 text-gray-300 border border-white/10'};const pill=`<span class="text-xs px-2 py-1 rounded-full ${statusColors[c.status]||'bg-white/10 text-gray-300 border border-white/10'}">${c.status}</span>`;card.innerHTML=`<div class="flex items-start justify-between"><h3 class="font-bold text-lg text-white pointer-events-none">${c.name}</h3>${pill}</div><p class="text-gray-400 text-sm mt-1 pointer-events-none">Planted: ${c.date}</p><div class="mt-4 pointer-events-none"><p class="text-sm"><span class="font-medium text-gray-300">Field Location:</span> ${c.city}, ${c.state}</p></div>`;card.addEventListener('click',()=>openDetails(c.id));cards.appendChild(card)})}function openDetails(id){const crop=crops.find(c=>c.id===id);if(!crop)return;editingId=crop.id;detailsName.textContent=crop.name;detailsInfo.textContent=`Planted on ${crop.date} at ${crop.city}, ${crop.state}`;analysisPrompt.style.display='block';analysisResult.style.display='none';analysisResult.innerHTML='<p class="text-center text-lg">Analyzing...</p>';photoUpload.value='';detailsModal.classList.remove('hidden')}function openForm(id=null){form.reset();citySel.innerHTML='<option value="">Select a State First</option>';citySel.disabled=true;if(id){editingId=id;const crop=crops.find(c=>c.id===id);modalTitle.textContent='Edit Crop';document.getElementById('crop-name').value=crop.name;document.getElementById('plant-date').value=crop.date;stateSel.value=crop.state;stateSel.dispatchEvent(new Event('change'));citySel.value=crop.city}else{editingId=null;modalTitle.textContent='Add a New Crop'}detailsModal.classList.add('hidden');formModal.classList.remove('hidden')}stateSel.addEventListener('change',()=>{const st=stateSel.value;citySel.innerHTML='<option value="">Select a City</option>';if(st&&stateCity[st]){citySel.disabled=false;stateCity[st].forEach(city=>citySel.add(new Option(city,city)))}else{citySel.disabled=true}});form.addEventListener('submit',e=>{e.preventDefault();const fd={name:e.target['crop-name'].value,state:e.target['crop-state'].value,city:e.target['crop-city'].value,date:e.target['plant-date'].value};if(editingId){const idx=crops.findIndex(c=>c.id===editingId);crops[idx]={...crops[idx],...fd};}else{crops.push({id:nextId++,...fd,status:'Pending Analysis'})}render();formModal.classList.add('hidden');editingId=null});addBtn.addEventListener('click',()=>openForm());editBtn.addEventListener('click',()=>openForm(editingId));cancelBtn.addEventListener('click',()=>formModal.classList.add('hidden'));closeDetails.addEventListener('click',()=>detailsModal.classList.add('hidden'));photoUpload.addEventListener('change',e=>{if(e.target.files&&e.target.files[0]){analysisPrompt.style.display='none';analysisResult.style.display='block';setTimeout(()=>{const levels=['Excellent','Good','Fair','Poor','Critical'];const colors={Excellent:'text-green-400',Good:'text-green-500',Fair:'text-yellow-400',Poor:'text-orange-500',Critical:'text-red-600'};const status=levels[Math.floor(Math.random()*levels.length)];const idx=crops.findIndex(c=>c.id===editingId);if(idx!==-1){crops[idx].status=status;render()}analysisResult.innerHTML=`<p class=\"text-center text-gray-300 mb-2\">Analysis Complete</p><p class=\"text-center text-3xl font-bold ${colors[status]}\">${status}</p><p class=\"text-center text-sm text-gray-400 mt-2\">Current Status has been updated based on this analysis.</p>`},2000)}});populateStates();render()})})();